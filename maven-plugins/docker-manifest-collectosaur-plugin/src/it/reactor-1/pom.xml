<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<groupId>cd.connect.common</groupId>
	<artifactId>reactor-1</artifactId>
	<version>1.1-SNAPSHOT</version>
	<name>reactor-1</name>
	<packaging>pom</packaging>

	<modules>
		<module>reactor-2</module>
		<module>module3</module>
	</modules>

	<properties>
		<build.version>1</build.version>
	</properties>

	<build>
		<plugins>
			<plugin>
				<groupId>cd.connect.pipeline</groupId>
				<artifactId>docker-manifest-collectosaur-plugin</artifactId>
				<version>@project.version@</version>
				<executions>
					<execution>
						<id>mamasaur</id>
						<phase>compile</phase>
						<goals>
							<goal>mamasaur</goal>
						</goals>
						<configuration>
							<additionalManifests>
								<additionalManifest>extra1.json</additionalManifest>
								<additionalManifest>extra2.json</additionalManifest>
							</additionalManifests>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>cd.connect.pipeline</groupId>
				<artifactId>docker-manifest-collectosaur-plugin</artifactId>
				<version>@project.version@</version>
				<executions>
					<execution>
						<id>collect</id>
						<phase>compile</phase>
						<goals>
							<goal>collectosaur</goal>
						</goals>
						<configuration>
							<dockerRegistry>gcr.io</dockerRegistry>
							<deployContainerImageName>featurehub/test-container</deployContainerImageName>
							<dockerRegistryBearerToken>@../../../docker-bearer-token.txt</dockerRegistryBearerToken>
							<targetEnvironment>ci</targetEnvironment>
							<inputManifestFile>target/connect-manifest.json</inputManifestFile>
							<outputYamlManifestFile>src/main/resources/manifest.yaml</outputYamlManifestFile>
							<outputJsonManifestFile>src/main/resources/manifest.json</outputJsonManifestFile>
							<pullRequest>My PR</pullRequest>
							<sha>12345</sha>
							<originalSha>789abdc</originalSha>
							<branch>monsters</branch>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>com.google.cloud.tools</groupId>
				<artifactId>jib-maven-plugin</artifactId>
				<version>1.4.0</version>
				<executions>
					<execution>
						<id>docker-build</id>
						<phase>compile</phase>
						<goals>
							<goal>build</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
					<allowInsecureRegistries>false</allowInsecureRegistries>
					<from>
						<image>gcr.io/featurehub/basedeploy:1.1</image>
					</from>
					<to>
						<image>${docker.repository}/featurehub/test-container:${collectosaurTimestamp}.${build.version}</image>
					</to>
					<container>
						<entrypoint>/bin/sh</entrypoint>
						<args>
							<arg>-c</arg>
							<arg>chmod +x /app/resources/deploy.sh &amp;&amp; /app/resources/deploy.sh</arg>
						</args>
						<labels>
							<buildSha>${collectosaurSha}</buildSha>
							<buildManifest>${collectosaurManifest}</buildManifest>
							<buildBranch>${collectosaurBranch}</buildBranch>
						</labels>
					</container>
				</configuration>
			</plugin>
		</plugins>
	</build>

</project>
